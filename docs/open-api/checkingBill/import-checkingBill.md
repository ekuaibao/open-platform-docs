# 新增或更新账单数据

import Control from "@theme/Control";

<Control
method="POST"
url="/api/openapi/v1/checking/importCheckingBill"
/>

<details>
  <summary><b>更新日志</b></summary>
  <div>

- [**2.0.1**](/updateLog/update-log#201)
    - 🆕 新增了本接口。

</div>
</details>

## Query Parameters

| 名称 | 类型 | 描述 | 是否必填 | 默认值 | 备注 |
| :--- | :--- | :--- | :--- |:--- | :--- |
| **accessToken** | String | 认证token | 必填 | - | 通过 [获取授权](/docs/open-api/getting-started/auth) 获取 `accessToken` |

## Body Parameters

| 名称 | 类型 | 描述 | 是否必填 | 默认值 | 备注                                                                                                                                                   |
| :--- | :--- | :--- |:-----|:--- |:-----------------------------------------------------------------------------------------------------------------------------------------------------|
| **checkingBillId**        | String | 账期ID            | 必填   | - | 引用 [创建账期](/docs/open-api/checkingBill/create-checkingBill) 返回的ID                                                                                     |
| **categoryId**            | String | 品类（业务对象）ID  | 必填   | - | 通过 [获取供应商账户及其品类](/docs/open-api/checkingBill/get-supplier-account) 获取 `categoryIds` 中的ID                                                             |
| **checkingBillDetails**   | Array  | 账单明细          | 必填   | - | 要新增或修改的账单明细数据，**最大不能超过 `100` 条**                                                                                                                     |
| **&emsp; ∟ 对账单ID**     | String | 对账单ID          | 必填   | - | 账单明细数据唯一标识<br/>**不存在时则新增账单明细，已存在则更新原数据**                                                                                                                  |
| **&emsp; ∟ ---**         | String | 品类模板中的其他字段显示名称 | 非必填  | - | 格式为 `{ "显示名称" : "字段值" }`<br/>**显示名称** 是 [获取供应商账户及其品类](/docs/open-api/checkingBill/get-supplier-account) 响应信息 `categoryIds` 中的 `fields` 里面的 `label` 值 |

:::tip
- **品类模板中的其他字段显示名称** 不同字段类型入参说明： 
  - 文本：字符串 
  - 城市：城市名称 
  - 时间：时间格式字段串，格式：`yyyy-MM-dd HH:MM:SS` 
  - 人员：员工名称 
  - 部门：部门名称 
  - 档案：档案名称 
  - 开关：是/否
  - 数字：数字字符串 
  - 金额：金额字符串
:::


## CURL
```json
curl --location 'https://app.ekuaibao.com/api/openapi/v1/checking/importCheckingBill?accessToken=ID01xCrcTXfOlp%3AID01wMzlJ6kcR9' \
--header 'accept: application/json' \
--header 'Content-Type: application/json' \
--data '{
    "checkingBillId": "ID01xCra1RWVeT", 
    "categoryId": "d711f575356f53c123c0", 
    "checkingBillDetails": [
        {
            "对账单ID": "12078478",
            "产品类型":  "机票",
            "出行类型":  "因公",
            "订单号":  "F240131183547131780",
            "票证状态":  "出票",
            "业务状态":  "正常",
            "申请事项编码":  "",
            "申请单号":  "S24000785",
            "申请单标题":  "杨xx的差旅申请单2024-02-01至2024-02-02海南项目验收",
            "票号":  "880-66226315",
            "最原始票号":  "880-66615",
            "上一次修改票号":  "880-662615",
            "航线类型":  "国内",
            "航程":  "海口 美兰国际机场-深圳 宝安国际机场",
            "航班号":  "HU7015",
            "起飞时间":  "2024-02-02 16:15",
            "降落时间":  "2024-02-02 17:30",
            "出发城市":  "海口",
            "到达城市":  "深圳",
            "舱位代码":  "P",
            "舱位":  "经济舱",
            "机票折扣":  "0.52",
            "航空公司名称":  "海南航空公司",
            "公司名称":  "公司名称1",
            "预定人":  "张三",
            "预定人末级部门":  "成功一部",
            "预定人全部部门":  "成功一部",
            "预定时间":  "2024-01-31 18:35:49",
            "支付时间":  "2024-01-31 18:35:57",
            "乘机人":  "张三",
            "工号":  "KPY00179",
            "乘机人末级部门":  "成功一部",
            "乘机人全部部门":  "成功一部",
            "票面价":  "900.0",
            "燃油费":  "40.0",
            "机建费":  "50.0",
            "服务费":  "0.0",
            "客户改签手续费":  "0.0",
            "客户退票手续费":  "0.0",
            "保险份数":  "0",
            "保险费":  "0.0",
            "优惠金额":  "5.0",
            "红包金额":  "0.0",
            "合计":  "985.0",
            "付款方式":  "企业",
            "预存支付金额":  "985.0",
            "授信支付金额":  "0.0",
            "微信支付金额":  "0.0",
            "支付宝支付金额":  "0.0",
            "个人钱包支付金额":  "0.0",
            "成本归属部门":  "成功一部",
            "成本归属项目":  "项目1",
            "成本归属备注":  "机票",
            "是否超标":  "否",
            "超标原因":  "",
            "超标详细":  "",
            "产品名称":  "合思自营",
            "法人实体":  "法人实体1"
        }
    ]
}'
```

## 成功响应
```json
{
    "value": {
        "success": true,
        "msg": ""       //失败原因，成功时为空
    }
}
```

## 失败响应

| HTTP状态码 | 错误码 | 描述             | 排查建议                                              |
| :--- | :--- |:---------------|:--------------------------------------------------|
| **200** | - | 账期不存在，请核查      | 请检查 `checkingBillId`（供应商账户ID）是否正确                 | 
| **200** | - | 该账期已对账，暂不支持导入  | 请检查 `checkingBillId`（供应商账户ID）是否正确                 | 
| **200** | - | 供应商品类不存在，请核查   | 请检查 `categoryId`（品类（业务对象）ID）是否正确                  | 
| **200** | - | 账单明细不能为空       | 请检查 `checkingBillDetails`（品类（业务对象）ID）是否为空         | 
| **200** | - | 账单明细单次不能超过100条 | 请检查 `checkingBillDetails`（品类（业务对象）ID）是否超过 `100` 条 | 
| **200** | - | 部分导入成功         | 请检查 `checkingBillDetails`（品类（业务对象）ID）数据           | 


